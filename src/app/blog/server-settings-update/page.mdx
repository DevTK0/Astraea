# Introducing offline support for server settings

## The Problem
Astraea's server setting update feature currently has a few problems.

1. You can't update the server when it's offline.
2. You can't view the server settings when it's offline.
3. Even if the server is running, the settings may be outdated.

To understand these problems, let's first look at how Astraea's server setting feature currently works:

\<Image showing sequence diagram fetching/updating config file on the server\>

As you can see from the image above, the server settings file in the server itself is essentially the source of truth. This makes sense intuitively but leads to the above problems. To fix this, we are going to have to re-design this flow. 

## Moving the source of truth
Instead of reading from the configuration file, let's store the settings in the database and generate a new configuration file whenever the settings are updated. By having the database as the source of truth, we'll be able to update the settings even when the server is offline.

The next step is to handle the syncing of the server configs itself. There are a number of ways to do this, but I've decided to go with a simple bash script that downloads the latest config file from S3 on startup. I chose this approach as I was intending to use S3 for other features in the future such as downloading of save files and multi-cloud support. Those features can leverage the same approach to support offline functionality. 

## Conclusion
Overall, this approach is much cleaner and can be generalisable to other features. I'll still have to figure out upstream syncing of the files from the server to S3 for the other features, but that's a problem for another day.